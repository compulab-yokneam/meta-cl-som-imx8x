From fd7f2af14850d7d82c026702cfaec3cf7bd20cfe Mon Sep 17 00:00:00 2001
From: Uri Mashiach <uri.mashiach@compulab.co.il>
Date: Tue, 3 Sep 2019 15:01:00 +0300
Subject: [PATCH 06/13] startek-ili9881c: cl-som-imx8x: add panel support

Signed-off-by: Uri Mashiach <uri.mashiach@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/sb-imx8x.dts | 43 +++++++++++++++++++++++++++++++
 arch/arm64/configs/cl-som-imx8x_defconfig |  1 +
 2 files changed, 44 insertions(+)

diff --git a/arch/arm64/boot/dts/compulab/sb-imx8x.dts b/arch/arm64/boot/dts/compulab/sb-imx8x.dts
index d3e744203c5d..c43f81471148 100644
--- a/arch/arm64/boot/dts/compulab/sb-imx8x.dts
+++ b/arch/arm64/boot/dts/compulab/sb-imx8x.dts
@@ -169,6 +169,40 @@
 	status = "okay";
 };
 
+/* MIPI Panel */
+&mipi_dsi2 {
+	pwr-delay = <10>;
+	status = "okay";
+};
+
+&mipi_dsi_bridge2 {
+	status = "okay";
+
+	port@1 {
+		mipi_dsi_bridge2_out: endpoint {
+			remote-endpoint = <&panel0_in>;
+		};
+	};
+
+	panel@0 {
+		compatible = "startek,kd050hdfia020";
+		reg = <0>;
+		reset-gpio = <&pca9555 12 GPIO_ACTIVE_LOW>;
+		dsi-lanes = <4>;
+		status = "okay";
+
+		port {
+			panel0_in: endpoint {
+				remote-endpoint = <&mipi_dsi_bridge2_out>;
+			};
+		};
+	};
+};
+
+&mipi_dsi_phy2 {
+	status = "okay";
+};
+
 /* CAN bus */
 &flexcan1 {
 	pinctrl-names = "default";
@@ -183,7 +217,16 @@
 };
 
 &iomuxc {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_hog_sb>;
+
 	sb-imx8x {
+		pinctrl_hog_sb: hoggrp {
+			fsl,pins = <
+				SC_P_MIPI_DSI1_GPIO0_00_MIPI_DSI1_GPIO0_IO00    0x00000021
+			>;
+		};
+
 		pinctrl_usdhc2_gpio: usdhc2gpiogrp {
 			fsl,pins = <
 				SC_P_USDHC1_RESET_B_LSIO_GPIO4_IO19	0x00000021
diff --git a/arch/arm64/configs/cl-som-imx8x_defconfig b/arch/arm64/configs/cl-som-imx8x_defconfig
index 9278f1aff92c..3615e06dd02b 100644
--- a/arch/arm64/configs/cl-som-imx8x_defconfig
+++ b/arch/arm64/configs/cl-som-imx8x_defconfig
@@ -485,6 +485,7 @@ CONFIG_DRM_RCAR_VSP=y
 CONFIG_DRM_MSM=m
 CONFIG_DRM_TEGRA=m
 CONFIG_DRM_PANEL_SIMPLE=y
+CONFIG_DRM_PANEL_STARTEK_ILI9881C=y
 CONFIG_DRM_PANEL_SEIKO_43WVF1G=y
 CONFIG_DRM_PANEL_RAYDIUM_RM67191=y
 CONFIG_DRM_NXP_SEIKO_43WVFIG=y
-- 
2.11.0

